---
title: ggplot2 绘图基础
layout: default
---

`ggplot2` 是一个用来绘制统计图形的 R `扩展包`，其背后设计的理念是`图形语法`。

作者是 `Hadley Wickham`, 该项目在 github 上是开源的 [https://github.com/hadley/ggplot2](https://github.com/hadley/ggplot2)。

```{r install, eval=FALSE}
install.packages("ggplot2") # 在使用之前先安装扩展包，有多个依赖的包会一起安装
```

```{r library, warning=FALSE}
library("ggplot2") # 在使用之前先安装扩展包，有多个依赖的包会一起安装
```

## 最佳参考资料

* [《ggplot2：数据分析与图形艺术》](http://book.douban.com/subject/24527091/) ：本书的作者就是 ggplot2 的设计者 Hadley Wickham， 介绍 ggplot2 的设计理念。
* [《R Graphics Cookbook》](http://book.douban.com/subject/10831542/) : 作者是  Winston Chang ，目前与 Hadley Wickham 一起在 RStudio 团队任职。这本书 基本上就是 ggplot2 的实践版参考工具书。有英文电子版，下载备用，所需时查询即可。
* [Offical website: ggplot2 documentation](http://docs.ggplot2.org/current/) ：ggplot2 的官方在线文档，几何图形、统计图形、主题等各种函数、参数的说明和大量的案例。


## 基本概念

* `Geometric objects` (`几何对象`)) ：简写为 `Geoms`，有名字（预先定义）的几何对象有：`point`、`line`、`bar`、`hisogram`、`boxppot`...

* `Statistics`(`统计变化`)

* `Scales`(`标度`)

* `aesthetics`(`图形属性`) ：横坐标、纵坐标，大小、颜色、形状等属性；

* `Faceting`(`分面`)： `facet_grid`(网格分面)、`facet_wrap`(封装分面)

* `Coordinate systems`(`坐标系统`)：笛卡尔坐标系、极坐标系

* `Position adjustments`(`位置调整`)：`dodge`(并排)、`fill`(堆叠：高度标准化为1)、`identity`(不做位置调整)、`jitter`(扰动)、`stack`(堆叠)

* `Themes`(主题)和`Elements`(元素)


## 数据集

ggplot2 扩展包中内置的一个数据集是 `diamonds`, 包含了月 5 万 4 千颗钻石的价格和质量信息。这组数据涵盖了反映钻石质量的四个“C”——克拉重量(carat)、切工(cut)、颜色(color)和净度(clarity)，以及五个物理指标——深度(depth)、钻面宽度(table)、x、y、z，以及价格(price)。

```{r dataset}
diamonds <- diamonds
str(diamonds)
```

这个数据集总共有 53940 个观测记录，10 个变量；变量名、类型、含义和说明如下：

变量 | 类型-类 | 变量含义 | 备注
--------- | -------- | --- | ---
carat | num | 克拉(重量) | 数值型
cut | Ord.factor | 切工(质量的好坏，评级) | 有序的因子
color | Ord.factor  | 颜色 | 有序的因子
clarity |O rd.factor  | 净度（纯净的程度） —— | 有序的因子
depth | num | 深度 | 数值型
table | num | 钻面宽度 | 数值型
price | int | 价格 | 整数型
x | num | 钻石体立起来后的长 | 整数型
y | num | 钻石体立起来后的宽 | 整数型
z | num | 钻石体立起来后的高 | 整数型



## geom_point 散点图

散点图就是点图，在几何对象上是一种 `point`(点)，有一个快捷函数 `geom_point()`。

```{r geom_point}
p <- ggplot(data = diamonds,
            mapping = aes(x = carat, y = price)
            )
p + geom_point()
```

### Overploting 遮盖绘制

使用图形属性 `alpha` 混合（调整透明度）让点呈现透明效果。取值经常使用分数，从 1 完全不透明，到 1/256。

```{r overploting}
p + geom_point(alpha = 1/10)
```


### colour 颜色

指定图形属性 `colour`(`color`) 为数据集中的某个变量，系统会将自动映射为默认颜色配置（也可手动指定）。

```{r aes_colour}
p <- ggplot(data = diamonds,
            mapping = aes(x = carat, y = price, colour = color)
            )
p + geom_point(alpha = 1/10)
```


### 数据表达式

指定图形属性 `colour` 为数据集中的某个变量，系统会将自动映射为默认颜色配置（也可手动指定）。

```{r data_expression}
p <- ggplot(data = diamonds,
            mapping = aes(x = log(carat), y = log(price), colour = color)
            )
p + geom_point(alpha = 1/10)
```


```{r data_expression_2}
p <- ggplot(data = diamonds,
            mapping = aes(x = carat, y = x * y * z)
            )
p + geom_point()
```

## 统计变化

### 平滑曲线

```{r geom_smooth}
p <- ggplot(data = diamonds,
            mapping = aes(x = carat, y = price)
            )
p + geom_point(alpha = 1/12) + geom_smooth()
```

## ggplot2 对象

```{r ggplot_summary}
p <- ggplot(data = diamonds,
            mapping = aes(x = carat, y = price)
            )
summary(p)
p + geom_point(alpha = 1/12) + geom_smooth()

p1 <- p + geom_point(alpha = 1/12) + geom_smooth()
summary(p1)

```


## ggsave 保存图形

```{r ggsave}
p2 <- ggplot(data = diamonds,
            mapping = aes(x = carat, y = price)
            ) + 
  geom_point(alpha = 1/12) + geom_smooth()

ggsave(file = "plot_01.png", plot = p2)
ggsave(file = "plot_02.jpg", plot = p2)
ggsave(file = "plot_03.pdf", plot = p2)

```

## Case study 案例分享
